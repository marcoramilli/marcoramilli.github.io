<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Volatility on Darkcomet &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">May 10, 2015</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          â€¢ 600 words 3 min. read
        </div>
        <h1>Volatility on Darkcomet</h1>
        <section id="post-content" class="article-content post">
          <div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;">Let's assume you've got a friend who asked you to have a look to his computer because he feels like something wrong is happening. What would you do?&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Option 1: "I have no idea about how to investigate on 'computer stuff', please contact your reseller "</div><div style="text-align: justify;">Option 2: "Ok, Let me access to your computer, I will see what I can do"</div><div style="text-align: justify;"><br />I's raining a lot and my friend was pretty serious about it so I decided to choose the option number 2... :O<br /><br /></div><div style="text-align: justify;">I've been starting by downloading <a href="http://www.moonsols.com/2011/07/18/moonsols-dumpit-goes-mainstream/" target="_blank">DumpIT</a> by MoonSols which is a "single click" Windows memory dumping tool. After a few command line answers I've got a fully dumped memory in one file. I downloaded it on my MAC and started the volatility analysis hunting the "something wrong".&nbsp; By running <b>imageinfo</b>,<b> </b>volatility analyses the memory layout getting back the memory profile used by identify the analyzed machine.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-zqMtr_-7hOU/VU5igQsEs9I/AAAAAAAAMUc/AQKHbsS2j9E/s1600/imageinfo_1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="123" src="http://1.bp.blogspot.com/-zqMtr_-7hOU/VU5igQsEs9I/AAAAAAAAMUc/AQKHbsS2j9E/s400/imageinfo_1.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Volatility imageinfo</td></tr></tbody></table><div style="text-align: justify;">Understanding what are the processes running on the analyzed machine is a foundamental step to grab the eventually "unwanted software". The following image shows the volatility <b>psxview</b>. Few processes are suspicious to me but the most weird is the one named <b>runddl32.exe</b>. It 's suspicious (at least to me) because the name mispelling and because it tries to evade "deskthrd" detection (not common at all). Psxview is a nice volatility plugin which compares the following different proces' searches in order figure out hiding techniques. The implemented process searche techniques follows:</div><ul style="text-align: left;"><li>&nbsp;PsActiveProcessHead linked list&nbsp;</li><li>&nbsp;EPROCESS pool scanning</li><li>&nbsp;ETHREAD pool scanning (then it references the owning EPROCESS)&nbsp;</li><li>&nbsp;PspCidTable&nbsp;</li><li>&nbsp;Csrss.exe handle table&nbsp;</li><li>&nbsp;Csrss.exe internal linked list  </li></ul><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-gnkOBOl5Yew/VU5kgIHQVfI/AAAAAAAAMUo/GPY64gdtyX4/s1600/psxview_2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="185" src="http://4.bp.blogspot.com/-gnkOBOl5Yew/VU5kgIHQVfI/AAAAAAAAMUo/GPY64gdtyX4/s400/psxview_2.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Volatility Psxview</td><td class="tr-caption" style="text-align: center;"></td></tr></tbody></table><div style="text-align: justify;">Let's have a deep look into <b>runddl32.exe</b> by running a <b>dlllist</b> on such a pid. Dlllist returns the memory location and the location path of each used DLL. This information is useful to recognazie malicious patterns in file locations. Malicious files are used to be located into TEMP directories due to dir rights. QED (See the following image) !</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-AEt1tJ-OW_4/VU5oTdnb61I/AAAAAAAAMU0/gOX8tY-c2RI/s1600/dlllist_3.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="97" src="http://1.bp.blogspot.com/-AEt1tJ-OW_4/VU5oTdnb61I/AAAAAAAAMU0/gOX8tY-c2RI/s400/dlllist_3.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Volatility dlllist</td></tr></tbody></table><div style="text-align: justify;">Volatility <b>dumpfiles </b>helps researchers to dump pieces of memory and saving them into files. The following image shows how I used dumpfiles to obtain the physical supicious files. Having them means to be able to perform static analysis (It wont run... no dyno) on the samples figuring out what they do and if they might be the cause of the "weird behavior".</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-hBWyopStCoc/VU5t5gg_EGI/AAAAAAAAMVE/dgq4y4x4Vmw/s1600/dumpfiles_4.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="21" src="http://4.bp.blogspot.com/-hBWyopStCoc/VU5t5gg_EGI/AAAAAAAAMVE/dgq4y4x4Vmw/s400/dumpfiles_4.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Volatility dumpfiles</td></tr></tbody></table><br /><div style="text-align: justify;">Just few steps into static analysis to discover the sample is actually doing something very bad such as: keylogging, selfupdate, drop and download,&nbsp; shllcoding etc etc...</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-ya7JXm2oyxE/VU5w8AqJFmI/AAAAAAAAMVU/3ixV24fENaY/s1600/pw_analisys_5.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="310" src="http://4.bp.blogspot.com/-ya7JXm2oyxE/VU5w8AqJFmI/AAAAAAAAMVU/3ixV24fENaY/s400/pw_analisys_5.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">AntiDebug functions</td></tr></tbody></table><div style="text-align: justify;">Looking into the sample's memory page -- for sure -- something strange is happening ! Page EXECUTE_READWRITE is found. VAD Tree (ref: <a href="http://www.dfrws.org/2007/proceedings/p62-dolan-gavitt.pdf" target="_blank">here</a>) is used to check for injections with a super positive result! We can know assert tha the PC was infected.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-mJaoVIx5Iag/VU5zTUqBTlI/AAAAAAAAMVg/_OJTlr1geNQ/s1600/VAAAds_7.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="366" src="http://2.bp.blogspot.com/-mJaoVIx5Iag/VU5zTUqBTlI/AAAAAAAAMVg/_OJTlr1geNQ/s400/VAAAds_7.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">VAD Tree search on volatility</td></tr></tbody></table>&nbsp; <br />Let me try to search the file on Virustotal to se if I get more on it.... Here it goes, VirusTotal identifies the sample as <b>Darkcomet</b>... a simple opensource Remote Aadministration Tool (RAT).<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-m6iHWWAmkzY/VU5wefR9eAI/AAAAAAAAMVM/TQdmKcO03L0/s1600/VT_6.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="111" src="http://2.bp.blogspot.com/-m6iHWWAmkzY/VU5wefR9eAI/AAAAAAAAMVM/TQdmKcO03L0/s400/VT_6.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">VirusTotal DarkComet</td></tr></tbody></table><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Weird things were happening to my friend's PC and he was right. Actually <a href="http://www.darkcomet.biz/" target="_blank">Darkcomet</a> is only one of the suspicuous file indentified on the psxview, for example I saw a notepad.exe child of explorer.exe and an cmd.exe child of explorer.exe as well. It was a nice hunting saturday night !</div></div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Volatility%20on%20Darkcomet-http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f&title=Volatility%20on%20Darkcomet" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fvolatility-on-darkcomet%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
