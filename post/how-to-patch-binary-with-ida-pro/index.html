<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> How to Patch Binary with IDA Pro &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Jan 25, 2011</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          â€¢ 600 words 3 min. read
        </div>
        <h1>How to Patch Binary with IDA Pro</h1>
        <section id="post-content" class="article-content post">
          <div style="text-align: justify;">Last night I received a couple of emails from friends of mine asking how to patch binaries through IDA Pro. I was pretty tired for writing a full answering email so I decided to send them a good link... I wasn't able to find out a good link on the argument. :O !!</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">For this reason today I want to show you how to patch a binary using IDA Pro. The patching process is maybe the most difficult part of reversing engineering since you need to modify directly the binary code without compromising the program control flow. You need to figure out what the binary does, where it does what, and how it performs the actions you want to modify. For example, if we consider a key-generator design process what is mainly needed is the key generation function. In order to build the generation procedure  (in the key-generator)we need to copy the "generator function" (in the binary) and paste it on a generic assembler "print out" template. Running the compiled template you will see as output the generated keys. If you prefer to patch the original key-generator you need inject/modify/delete instructions directly on the binary without altering the control flow and without triggering exception handlers.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><i>To remember: In this post I am not going into the details on "the binary patching process" but I am going to explain how to use IDA for such a process.</i></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">First of all you need to edit an IDA configuration file called <b>idagui.cfg </b>. The file has been placed from the installer into your IDAFolder<ida>/cfg/idagui.cfg. On my Windows machine it is placed into: C:\Program Files\IDA Free\cfg\idagui.cfg. </ida></div><div style="text-align: justify;"><ida><br /></ida></div><div style="text-align: justify;"><ida>You want to change the following two lines: <b>DISPLAY_PATCH_SUBMENU = YES</b> and <b>DISPLAY_COMMAND_LINE = NO </b>(but you might want to see it, so put an uppercase YES)</ida></div><div><br /></div><div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_gK7b9huwiwY/TT6vh3jK-hI/AAAAAAAAKlQ/uNBdxWafdLA/s1600/patch1.png"><img style="text-align: left;display: block; margin-top: 0px; margin-right: auto; margin-bottom: 10px; margin-left: auto; cursor: pointer; width: 400px; height: 51px; " src="http://2.bp.blogspot.com/_gK7b9huwiwY/TT6vh3jK-hI/AAAAAAAAKlQ/uNBdxWafdLA/s400/patch1.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5566079185858525714" /></a></div><div>Running your IDA Pro you now see a new sub menu <b>EDIT -> Patch Program</b>.</div><div><br /></div><div><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_gK7b9huwiwY/TT6xhN9vjcI/AAAAAAAAKlY/DcIRuIPigJc/s1600/Patch2.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 388px;" src="http://4.bp.blogspot.com/_gK7b9huwiwY/TT6xhN9vjcI/AAAAAAAAKlY/DcIRuIPigJc/s400/Patch2.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5566081373718941122" /></a></div><div><br /></div><div style="text-align: justify;"><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_gK7b9huwiwY/TT6xhN9vjcI/AAAAAAAAKlY/DcIRuIPigJc/s1600/Patch2.png"></a>Now, using the "Patch program" submenu you are able to edit the IDA database. Don't forget that you are now editing the IDA database which represents the real binary (it isn't the original binary) so you aren't patching you binary yet. </div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Once you've done with your changes you are now ready to generate the <b>DIFF</b> file through: FILE->Produce File-> Create DIFF File, as shown in the following image.</div><div><br /></div><div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_gK7b9huwiwY/TT60DHtLEPI/AAAAAAAAKlg/tRyJG_Bz6kI/s1600/patch3.png"><img style="display:block; margin:0px auto 10px; text-align:center;cursor:pointer; cursor:hand;width: 400px; height: 221px;" src="http://4.bp.blogspot.com/_gK7b9huwiwY/TT60DHtLEPI/AAAAAAAAKlg/tRyJG_Bz6kI/s400/patch3.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5566084155177636082" /></a></div><div style="text-align: justify;">The <b>DIFF</b> file does NOT include the copy of the modified binary but it simply enumerates what and where changes happened. For example the following  listing is an example of what <b>DIFF</b> file includes.</div><div><br /></div><div><p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">name.exe</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">00001545: 7D EB</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">00001546: 2B 2A</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">0000158D: 7C 7D</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">0000158E: B9 B8</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">000015DE: 75 74</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">000015DF: 1F 1E</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">000015E3: 76 75</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">000015E4: 16 15</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">00001607: 74 EB</p> <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 10.0px Monaco">00001608: 29 28</p></div><br /><div style="text-align: justify;">In address <i>00001545</i>  the byte<b> </b><i>7D</i> became <i>EB,</i> in address <i>000015DF</i> the byte <i>1F</i> became <i>1E</i> etc.</div><div style="text-align: justify;">Now what you need is to download and compile the following utility called <b>ida_patcher.c </b>(from here).  ida_patcher does the real patching.</div><div style="text-align: justify;"><span class="Apple-style-span"  style="font-family:'Lucida Grande';"><span class="Apple-style-span"  style="font-size:medium;"><br /></span></span></div><div style="text-align: justify;"><span class="Apple-style-span"  style="font-family:'Lucida Grande';"><span class="Apple-style-span"  style="font-size:medium;">Lets run the patcher in the following way :</span></span></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><b>./ida_patcher -i executable.exe -p executable.diff</b></div><div style="text-align: justify;"><b><br /></b></div><div style="text-align: justify;">Where <b>executable.exe</b> is the original binary file and <b>executable.diff</b> is the <b>DIFF</b> file from IDA Pro. Watch out that ida_patcher modifies the original binary, so be sure to have a backup of your original one. Now you've got the patched file ready to be spread ;)</div><div><b><br /></b></div><div><b>*UPDATE*</b></div><div>Another great tool to batch binary using DIFF file is <a href="http://stalkr.net/files/ida/idadif.py">here</a> (thanks to StalkR)</div><div><b><br /></b></div><div><b><br /></b></div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=How%20to%20Patch%20Binary%20with%20IDA%20Pro-http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f&title=How%20to%20Patch%20Binary%20with%20IDA%20Pro" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fhow-to-patch-binary-with-ida-pro%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
