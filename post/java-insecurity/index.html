<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Java insecurity &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Oct 23, 2007</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          • 600 words 3 min. read
        </div>
        <h1>Java insecurity</h1>
        <section id="post-content" class="article-content post">
          <p><div style="text-align: justify;">Last year I posted on java bug-track some security issues about java security engine. Today I&rsquo;ve found some free time and I&rsquo;ve seen if some of these security issues have been corrected .<br /></div><div style="text-align: justify;">Well I&rsquo;ve founded again some problems on java byte code caused from bad flags checking. The main problem concerns the poor connection between compiler and linker on java core verifier. Let me try  a really easy example. Write A.java and B.java classes in the following manner. </div><blockquote><div style="text-align: left;">public class A {</div><div style="text-align: left;">public int value = 200;</div><div style="text-align: left;">}</div><div style="text-align: left;"><br /></div><div style="text-align: left;">public B{</div><div style="text-align: left;"><span class="Apple-tab-span" style="white-space:pre"> </span>public static void main(String[] s){</div><div style="text-align: left;"><span class="Apple-tab-span" style="white-space:pre"> </span>System.out.println(new A().value);</div><div style="text-align: left;"><span class="Apple-tab-span" style="white-space:pre"> </span>}</div><div style="text-align: left;">}</div></blockquote><div style="text-align: justify;">Well, try to compile A and B (<span class="Apple-style-span" style="font-style: italic;">javac *.java)</span> and try to run B (<span class="Apple-style-span" style="font-style: italic;"> java B</span>). Nothing strange yet. Right now all these stuff work fine but if you try to modify the public field (<span class="Apple-style-span" style="font-style: italic;">public int value=200</span>)in private one (<span class="Apple-style-span" style="font-style: italic;">private int value=200</span>) compiling only A.java (<span class="Apple-style-span" style="font-style: italic;">javac A.java</span>) you&rsquo;ll observe that <span class="Apple-style-span" style="font-style: italic;">java B </span>behavior<span class="Apple-style-span" style="font-style: italic;"> will not change ! </span>What happened ? The linker has not been upgraded. Yep, but how can we apply this &ldquo;linker miss upgraded&rdquo; to normal life ?<br /></div><div style="text-align: justify;">Every commercial software has a protection, often the protection is a serial number or a license code. The software has to control about the correctness of inserted number and to do that it often uses a private function &ldquo;serialNumber(String serial)&rdquo;.  If we don&rsquo;t know any reverse engineering technique we should change the &ldquo;serialNumber&rdquo; private function in a public one afterward forging a brute force code able to exploit the previous function. Let me try with  an different but easy example in order to understand the Java Code Violence technique.<br /></div><br /><center><br /><img src="http://content.screencast.com/media/a9e146e2-518d-405d-9ee1-4a6d02cdbd2c_aa65a76c-fff6-4e10-b662-ceba8e05d445_static_0_0_00000004.png" /></center><br /><div><br /><div style="text-align: justify;">This class has a private function named sum. We assume to have only .class code and not the sources. With java decompiler (<i>javap -c -private <class name=""></class></i>) we can understand the name and how many private variable/method the .class got.<br /></div></div><br /><center><br /><div><br /><img src="http://content.screencast.com/media/831a1f71-608e-4122-a02f-2ed1949f791c_aa65a76c-fff6-4e10-b662-ceba8e05d445_static_0_0_00000005.png" /><br /></div><br /><div><br /><img src="http://content.screencast.com/media/cc8b9eae-8511-4d6b-a216-c2a6d1d84a6d_aa65a76c-fff6-4e10-b662-ceba8e05d445_static_0_0_00000006.png" /><br /></div><br /></center><br /><div><br /><div style="text-align: justify;">Our attack will focused on private static int sum(). The main goal is to change this function from private to public, in order to do that we can use a simple java hash interpreter as <a href="http://www.dataworkshop.de/">DataWorkShop</a>. Open The .class file with JavaInterpreter and search for private static int sum(). The right method is the number 3, it&rsquo;s easy to understand from previous <i>javap screen, c</i>hange the private value from &ldquo;YES&rdquo; to &ldquo;NO&rdquo; and save the poisoned code.<br /></div></div><i><br /><center><br /><div><br /><img src="http://content.screencast.com/media/190f7de2-8bb5-482f-b2f8-83141d8ac950_aa65a76c-fff6-4e10-b662-ceba8e05d445_static_0_0_00000007.png" /><br /></div><br /></center><br /><div><br /><div style="text-align: justify;"><span class="Apple-style-span" style="font-style: normal; ">Well, now we should forge two specific java classes, the first must named as the attacked class and it must have a fake public method called as the attacked class&rsquo; private method. The second class is the true attacker &rsquo;s class able to use the private method, in these images it has been called Violence.java.</span><br /></div></div><br /><div><br /><center><br /><img src="http://content.screencast.com/media/e552965f-303e-4fbd-8e9e-63b60ec9be82_aa65a76c-fff6-4e10-b662-ceba8e05d445_static_0_0_00000008.png" /><br /></center><br /></div><br /><br /><div><br /><div style="text-align: justify;"><span class="Apple-style-span" style="font-style: normal; ">Now compile Violence.java and then remove the fake class named as the attacked class and rename the attacked class with its original name and run the Violence.class !! You have just bypassed the Java Security Engine. With the same principle you can modify private fields, private classes and of course private methods building self made classes that use private field of commercial classes. One of the most useful scenario is to build own brute forcer on a private &ldquo;serial check&rdquo; function. The problem is in the verifier engine. The Java verifier has the certifier task, it should control every piece of code before charge it in the right memory location. Also the java manager engine should control that run-time code does not damage JVM and/or machine memory but it seems not working so well. I hope that this easy kind of attack works only in my not-always-upgraded and old machines.</span><br /></div></div><br /></i></p>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Java%20insecurity-http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f&title=Java%20insecurity" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fjava-insecurity%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
