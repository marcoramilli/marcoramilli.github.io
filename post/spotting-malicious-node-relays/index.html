<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Spotting Malicious Node Relays &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Dec 20, 2015</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          â€¢ 2800 words 14 min. read
        </div>
        <h1>Spotting Malicious Node Relays</h1>
        <section id="post-content" class="article-content post">
          <div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;">TOR is a well known "software" able to protect communications dispatching packets between different relays spread over the world run by a network of volunteers. Because the high rate of anonymity TOR has been used over the past years to cover malicious actions by physical and cyber attackers. TOR, especially through its browser implementation (the TOR Browser), is also know as one of the main (by meaning of the most used) way to get access to the Dark WEB &nbsp;in where "malicious" people buy and sell illegal stuff through dark markets. Each relay belonging to the network is able to decide if being an ExitPoint (in the following picture represented by the last machine contacting "Bob") or just a middle relay (in the following picture: a TOR node highlighted by "green cross") depending on its own configuration status. If the relay decides to be an ExitNode it will expose its own IP address to the public world; it's usually a good idea alert local police and used ISP about that in order to avoid penalties.</div><br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-YK7ev0PDdck/VnR7yONiBDI/AAAAAAAAMfg/syXPTA2CDPc/s1600/Screen%2BShot%2B2015-12-18%2Bat%2B22.31.19.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="255" src="http://1.bp.blogspot.com/-YK7ev0PDdck/VnR7yONiBDI/AAAAAAAAMfg/syXPTA2CDPc/s400/Screen%2BShot%2B2015-12-18%2Bat%2B22.31.19.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">From TheTorProject.org</td></tr></tbody></table><br /><div style="text-align: justify;">During the past year mass-media such as: television shows, radio stations, youtube channels, Facebook groups, etc. disclosed many dark markets address swelling up flows of curios people to the DarkWeb and consequently exposing them to numerous new attack scenarios. Indeed new attackers set up Exit Nodes or Relay Nodes in order to spy and/or compromise communication flows passing through them. The attack could happen in many single ways but the most used ones (as today writing) are mainly three:</div><div style="text-align: justify;"><br /></div><ol style="text-align: left;"><li style="text-align: justify;"><b>DNS</b> <b>Poisoning</b>: This technique consists in redirecting DNS calls related to well-known web sites to creative fake pages containing exploit kits able to eventually compromise &nbsp;user browsers.</li><li style="text-align: justify;"><b>File</b> <b>Patching</b>: This technique consists in altering the requested file during its way back to destination by adding malicious content to it: this happens directly on ExitPoint/Relay before being issued to original requester.</li><li style="text-align: justify;"><b>Certification</b> <b>Substitution</b> (SSL - MITM). This techniques consists in substitute the real web-site certificate with a fake one in order to be able to decrypt the communication flow intercepting credentials and parameters.</li></ol><div><div style="text-align: justify;">Working on CyberSecurity means being aware of such attacks and being able to decide whenever passing through TOR relays or not. Please be aware that TOR is not the only anonymous networks in the DarkWeb ! &nbsp;</div></div><div><div style="text-align: justify;"><br /></div></div><div><div style="text-align: justify;">&nbsp;My goal was to figure out when my TOR flow was passing through malicious relays. For such a reason I decided to write a little python script able to make some quick and dirty checks such as: DNS Poison, File patching and SSL-MITM which are significant checks on the status of the used TOR circuit. The script has 2 years old and it was undisclosed until now. I decided to public it since scientific researches have been implemented an advanced version of my FindMalExit.py. Please have a read <a href="http://www.cs.kau.se/philwint/spoiled_onions/techreport.pdf">here</a>&nbsp;for the full paper on that topic.</div></div><div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The <b>IDEA</b>.</div><div style="text-align: justify;">Well, actually it is a pretty simple idea: "let's grab certificates, IP addresses and files without passing through TOR network (or passing through trusted circuits) and then replicate &nbsp;the process passing through all available relays. Compare the results and check if somebody is chaining the "ground".</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The <b>IMPLEMENTATION</b>:</div><div style="text-align: justify;">Following please find my poor code. Please remember it is a non production code so <b>do not use</b> on production envronments! (This code is just a first release of a bigger project now maintained by&nbsp;<a href="http://www.yoroi.company/">Yoroi</a> ). I decided to publish the code in HTML format (so I can easily comment it), if you need it in a more common way check my <a href="https://github.com/marcoramilli">github</a> repo (<a href="https://github.com/marcoramilli/malexit">here</a>)&nbsp;</div><br /><br /></div><div><style type="text/css">td.linenos { background-color: #f0f0f0; padding-right: 10px; } span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; } pre { line-height: 125%; } body .hll { background-color: #ffffcc } body  { background: #f8f8f8; } body .c { color: #408080; font-style: italic } /* Comment */ body .err { border: 1px solid #FF0000 } /* Error */ body .k { color: #008000; font-weight: bold } /* Keyword */ body .o { color: #666666 } /* Operator */ body .cm { color: #408080; font-style: italic } /* Comment.Multiline */ body .cp { color: #BC7A00 } /* Comment.Preproc */ body .c1 { color: #408080; font-style: italic } /* Comment.Single */ body .cs { color: #408080; font-style: italic } /* Comment.Special */ body .gd { color: #A00000 } /* Generic.Deleted */ body .ge { font-style: italic } /* Generic.Emph */ body .gr { color: #FF0000 } /* Generic.Error */ body .gh { color: #000080; font-weight: bold } /* Generic.Heading */ body .gi { color: #00A000 } /* Generic.Inserted */ body .go { color: #888888 } /* Generic.Output */ body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */ body .gs { font-weight: bold } /* Generic.Strong */ body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */ body .gt { color: #0044DD } /* Generic.Traceback */ body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */ body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */ body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */ body .kp { color: #008000 } /* Keyword.Pseudo */ body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */ body .kt { color: #B00040 } /* Keyword.Type */ body .m { color: #666666 } /* Literal.Number */ body .s { color: #BA2121 } /* Literal.String */ body .na { color: #7D9029 } /* Name.Attribute */ body .nb { color: #008000 } /* Name.Builtin */ body .nc { color: #0000FF; font-weight: bold } /* Name.Class */ body .no { color: #880000 } /* Name.Constant */ body .nd { color: #AA22FF } /* Name.Decorator */ body .ni { color: #999999; font-weight: bold } /* Name.Entity */ body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */ body .nf { color: #0000FF } /* Name.Function */ body .nl { color: #A0A000 } /* Name.Label */ body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */ body .nt { color: #008000; font-weight: bold } /* Name.Tag */ body .nv { color: #19177C } /* Name.Variable */ body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */ body .w { color: #bbbbbb } /* Text.Whitespace */ body .mb { color: #666666 } /* Literal.Number.Bin */ body .mf { color: #666666 } /* Literal.Number.Float */ body .mh { color: #666666 } /* Literal.Number.Hex */ body .mi { color: #666666 } /* Literal.Number.Integer */ body .mo { color: #666666 } /* Literal.Number.Oct */ body .sb { color: #BA2121 } /* Literal.String.Backtick */ body .sc { color: #BA2121 } /* Literal.String.Char */ body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */ body .s2 { color: #BA2121 } /* Literal.String.Double */ body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */ body .sh { color: #BA2121 } /* Literal.String.Heredoc */ body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */ body .sx { color: #008000 } /* Literal.String.Other */ body .sr { color: #BB6688 } /* Literal.String.Regex */ body .s1 { color: #BA2121 } /* Literal.String.Single */ body .ss { color: #19177C } /* Literal.String.Symbol */ body .bp { color: #008000 } /* Name.Builtin.Pseudo */ body .vc { color: #19177C } /* Name.Variable.Class */ body .vg { color: #19177C } /* Name.Variable.Global */ body .vi { color: #19177C } /* Name.Variable.Instance */ body .il { color: #666666 } /* Literal.Number.Integer.Long */    </style></div><div class="highlight"><pre><span class="c">#!/usr/bin/env python2</span><br /><br /><span class="c">#========================================================================#</span><br /><span class="c">#               THIS IS NOT A PRODUCTION RELEASED SOFTWARE               #</span><br /><span class="c">#========================================================================#</span><br /><span class="c"># Purpose of finMaliciousRelayPoints is to proof the way it's possible to#</span><br /><span class="c"># discover TOR malicious Relays Points. Please do not use it in&nbsp;         #</span></pre><pre><span class="c"># any production  environment                                            #</span></pre><pre><span class="c"># Author: Marco Ramilli                                                  #</span><br /><span class="c"># eMail: XXXXXXXX                                                        #</span><br /><span class="c"># WebSite: marcoramilli.blogspot.com                                     #</span><br /><span class="c"># Use it at your own                                                     #</span><br /><span class="c">#========================================================================#</span><br /><br /><span class="c">#==============================Disclaimer: ==============================#</span><br /><span class="c">#THIS SOFTWARE IS PROVIDED BY THE AUTHOR "AS IS" AND ANY EXPRESS OR      #</span><br /><span class="c">#IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED          #</span><br /><span class="c">#WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE  #</span><br /><span class="c">#DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,      #</span><br /><span class="c">#INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES      #</span><br /><span class="c">#(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR      #</span><br /><span class="c">#SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)      #</span><br /><span class="c">#HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,     #</span><br /><span class="c">#STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING   #</span><br /><span class="c">#IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE      #</span><br /><span class="c">#POSSIBILITY OF SUCH DAMAGE.                                             #</span><br /><span class="c">#========================================================================#</span><br /><br /><br /><br /><br /><span class="c">#-------------------------------------------------------------------------</span><br /><span class="c">#------------------- GENERAL SECTION -------------------------------------</span><br /><span class="c">#-------------------------------------------------------------------------</span><br /><span class="kn">import</span> <span class="nn">StringIO</span><br /><span class="kn">import</span> <span class="nn">tempfile</span><br /><span class="kn">import</span> <span class="nn">time</span><br /><span class="kn">import</span> <span class="nn">hashlib</span><br /><span class="kn">import</span> <span class="nn">traceback</span><br /><span class="kn">from</span>   <span class="nn">geoip</span>         <span class="kn">import</span>  <span class="n">geolite2</span><br /><span class="kn">import</span> <span class="nn">stem.control</span><br /><br /><span class="n">TRUSTED_HOP_FINGERPRINT</span> <span class="o">=</span> <span class="s">'379FB450010D17078B3766C2273303C358C3A442'</span>&nbsp;</pre><pre><span class="c">#trusted hop</span><br /><span class="n">SOCKS_PORT</span>              <span class="o">=</span> <span class="mi">9050</span><br /><span class="n">CONNECTION_TIMEOUT</span>      <span class="o">=</span> <span class="mi">30</span>  <span class="c"># timeout before we give up on a circuit</span><br /><br /><span class="c">#-------------------------------------------------------------------------</span><br /><span class="c">#---------------- File Patching Section ----------------------------------</span><br /><span class="c">#-------------------------------------------------------------------------</span><br /><span class="kn">import</span> <span class="nn">pycurl</span><br /><br /><span class="n">check_files</span>               <span class="o">=</span> <span class="p">{</span><br />                             <span class="s">"http://live.sysinternals.com/psexec.exe"</span><span class="p">,</span><br />                             <span class="s">"http://live.sysinternals.com/psexec.exe"</span><span class="p">,</span><br />                             <span class="s">"http://live.sysinternals.com/psping.exe"</span><span class="p">,</span> <span class="p">}</span><br /><span class="n">check_files_patch_results</span> <span class="o">=</span> <span class="p">[]</span><br /><br /><span class="k">class</span> <span class="nc">File_Check_Results</span><span class="p">:</span><br />    <span class="sd">"""</span><br /><span class="sd">    Analysis Results against File Patching</span><br /><span class="sd">    """</span><br />    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">filen</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">exitnode</span><span class="p">,</span> <span class="n">found_hash</span><span class="p">):</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">url</span>           <span class="o">=</span> <span class="n">url</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>      <span class="o">=</span> <span class="n">filen</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span>      <span class="o">=</span> <span class="n">filepath</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">exitnode</span>      <span class="o">=</span> <span class="n">exitnode</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">filehash</span>      <span class="o">=</span> <span class="n">found_hash</span><br /><br /><br /><span class="c">#------------------------------------------------------------------------</span><br /><span class="c">#------------------- DNS Poison Section ---------------------------------</span><br /><span class="c">#------------------------------------------------------------------------</span><br /><span class="kn">import</span> <span class="nn">dns.resolver</span><br /><span class="kn">import</span> <span class="nn">socks</span><br /><span class="kn">import</span> <span class="nn">socket</span><br /><br /><span class="n">check_domain_poison_results</span> <span class="o">=</span> <span class="p">[]</span><br /><span class="n">domains</span>                     <span class="o">=</span> <span class="p">{</span><br />                                 <span class="s">"www.youporn.com"</span><span class="p">,</span><br />                                 <span class="s">"youporn.com"</span><span class="p">,</span><br />                                 <span class="s">"www.torproject.org"</span><span class="p">,</span><br />                                 <span class="s">"www.wikileaks.org"</span><span class="p">,</span><br />                                 <span class="s">"www.i2p2.de"</span><span class="p">,</span><br />                                 <span class="s">"torrentfreak.com"</span><span class="p">,</span><br />                                 <span class="s">"blockchain.info"</span><span class="p">,</span><br /><span class="p">}</span><br /><br /><span class="k">class</span> <span class="nc">Domain_Poison_Check</span><span class="p">:</span><br />    <span class="sd">"""</span><br /><span class="sd">    Analysis Results against Domain Poison</span><br /><span class="sd">    """</span><br />    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>  <span class="o">=</span> <span class="n">domain</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="p">[]</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">path</span>    <span class="o">=</span> <span class="p">[]</span><br /><br />    <span class="k">def</span> <span class="nf">pushAddr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add</span><span class="p">):</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">add</span><span class="p">)</span><br /><br />    <span class="k">def</span> <span class="nf">pushPath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><br /><br /><span class="c">#-----------------------------------------------------------------------</span><br /><span class="c">#------------------- SSL Sltrip Section --------------------------------</span><br /><span class="c">#-----------------------------------------------------------------------</span><br /><span class="kn">import</span> <span class="nn">OpenSSL</span><br /><span class="kn">import</span> <span class="nn">ssl</span><br /><br /><span class="n">check_ssl_strip_results</span>   <span class="o">=</span> <span class="p">[]</span><br /><span class="n">ssl_strip_monitored_urls</span> <span class="o">=</span> <span class="p">{</span><br />                            <span class="s">"www.google.com"</span><span class="p">,</span><br />                            <span class="s">"www.microsoft.com"</span><span class="p">,</span><br />                            <span class="s">"www.apple.com"</span><span class="p">,</span><br />                            <span class="s">"www.bbc.com"</span><span class="p">,</span><br /><span class="p">}</span><br /><br /><span class="k">class</span> <span class="nc">SSL_Strip_Check</span><span class="p">:</span><br />    <span class="sd">"""</span><br /><span class="sd">    Analysis Result against SSL Strip</span><br /><span class="sd">    """</span><br />    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">public_key</span><span class="p">,</span> <span class="n">serial_number</span><span class="p">):</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">domain</span>        <span class="o">=</span> <span class="n">domain</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span>    <span class="o">=</span> <span class="n">public_key</span><br />        <span class="bp">self</span><span class="o">.</span><span class="n">serial_number</span> <span class="o">=</span> <span class="n">serial_number</span><br /><br /><br /><span class="c">#----------------------------------------------------------------------</span><br /><span class="c">#----------------     Starting Coding   -------------------------------</span><br /><span class="c">#----------------------------------------------------------------------</span><br /><br /><br /><span class="k">def</span> <span class="nf">sslCheckOriginal</span><span class="p">():</span><br />    <span class="sd">"""</span><br /><span class="sd">    Download the original Certificate without TOR connection</span><br /><span class="sd">    """</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Populating SSL for later check'</span><span class="p">)</span><br />    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">ssl_strip_monitored_urls</span><span class="p">:</span><br />        <span class="k">try</span><span class="p">:</span><br />            <span class="n">cert</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">get_server_certificate</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="mi">443</span><span class="p">))</span><br />            <span class="n">x509</span> <span class="o">=</span> <span class="n">OpenSSL</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="n">load_certificate</span><span class="p">(</span><span class="n">OpenSSL</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="n">FILETYPE_PEM</span><span class="p">,</span> <span class="n">cert</span><span class="p">)</span><br />            <span class="n">p_k</span>  <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">get_pubkey</span><span class="p">()</span><br />            <span class="n">s_n</span>  <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">get_serial_number</span><span class="p">()</span><br /><br />            <span class="k">print</span><span class="p">(</span><span class="s">'[+] Acquired Certificate: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span><br />            <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; serial_number </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">s_n</span><span class="p">)</span><br />            <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; public_key </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">p_k</span><span class="p">)</span><br /><br />            <span class="n">check_ssl_strip_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SSL_Strip_Check</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">p_k</span><span class="p">,</span> <span class="n">s_n</span><span class="p">))</span><br /><br />        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />            <span class="k">print</span><span class="p">(</span><span class="s">'[-] Error While Acquiring certificats on setup phase !'</span><span class="p">)</span><br />            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br />    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><br /><span class="k">def</span> <span class="nf">fileCheckOriginal</span><span class="p">():</span><br />    <span class="sd">"""</span><br /><span class="sd">    Downloading file ORIGINAL without TOR</span><br /><span class="sd">    """</span><br /><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Populating File Hasing for later check'</span><span class="p">)</span><br />    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">check_files</span><span class="p">:</span><br />        <span class="k">try</span><span class="p">:</span><br />            <span class="n">data</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><br />            <span class="n">file_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><br />            <span class="n">_</span><span class="p">,</span><span class="n">tmp_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">"exitmap_</span><span class="si">%s</span><span class="s">_"</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">)</span><br /><br />            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span><br />                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'[+] Saving File  </span><span class="se">\"</span><span class="si">%s</span><span class="se">\"</span><span class="s">.'</span> <span class="o">%</span> <span class="n">tmp_file</span><span class="p">)</span><br />                <span class="n">check_files_patch_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">File_Check_Results</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">tmp_file</span><span class="p">,</span> <span class="s">"NO"</span><span class="p">,</span> <span class="n">sha512_file</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">))</span> <span class="p">)</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'[+] First Time we see the file..'</span><span class="p">)</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; exitnode : None'</span>       <span class="p">)</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; :url:  </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>     <span class="p">)</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; :filePath:  </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">))</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; :file Hash: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">sha512_file</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">)))</span><br />        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'[-] Error ! </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span><br />                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br />                <span class="k">pass</span><br />    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><br /><span class="k">def</span> <span class="nf">resolveOriginalDomains</span><span class="p">():</span><br />    <span class="sd">"""</span><br /><span class="sd">        Resolving DNS For original purposes</span><br /><span class="sd">    """</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Populating Domain Name Resolution for later check '</span><span class="p">)</span><br /><br />    <span class="k">try</span><span class="p">:</span><br />        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span><br />            <span class="n">response</span> <span class="o">=</span> <span class="n">dns</span><span class="o">.</span><span class="n">resolver</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><br />            <span class="n">d</span> <span class="o">=</span> <span class="n">Domain_Poison_Check</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><br />            <span class="k">print</span><span class="p">(</span><span class="s">'[+] Domain: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span><br />            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">' |____&gt; maps to </span><span class="si">%s</span><span class="s">.'</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">address</span><span class="p">))</span><br />                <span class="n">d</span><span class="o">.</span><span class="n">pushAddr</span><span class="p">(</span><span class="n">record</span><span class="p">)</span><br />            <span class="n">check_domain_poison_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><br />        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br />    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />        <span class="k">print</span><span class="p">(</span><span class="s">'[+] Exception: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span><br />        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br />        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><br /><span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="n">url</span><span class="p">):</span><br />  <span class="sd">"""</span><br /><span class="sd">  Uses pycurl to fetch a site using the proxy on the SOCKS_PORT.</span><br /><span class="sd">  """</span><br />  <span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span><br />  <span class="n">query</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">URL</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">PROXY</span><span class="p">,</span> <span class="s">'localhost'</span><span class="p">)</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">PROXYPORT</span><span class="p">,</span> <span class="n">SOCKS_PORT</span><span class="p">)</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">PROXYTYPE</span><span class="p">,</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">PROXYTYPE_SOCKS5_HOSTNAME</span><span class="p">)</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">CONNECTTIMEOUT</span><span class="p">,</span> <span class="n">CONNECTION_TIMEOUT</span><span class="p">)</span><br />  <span class="n">query</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">pycurl</span><span class="o">.</span><span class="n">WRITEFUNCTION</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="p">)</span><br /><br />  <span class="k">try</span><span class="p">:</span><br />    <span class="n">query</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span><br />    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><br />  <span class="k">except</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span><br />    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">"Unable to reach </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)"</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span><br /><br /><br /><br /><span class="k">def</span> <span class="nf">scan</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span><br />  <span class="sd">"""</span><br /><span class="sd">  Scan Tor Relays Point to find File Patching</span><br /><span class="sd">  """</span><br /><br />  <span class="k">def</span> <span class="nf">attach_stream</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span><br />    <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">'NEW'</span><span class="p">:</span><br />      <span class="k">try</span><span class="p">:</span><br />        <span class="n">controller</span><span class="o">.</span><span class="n">attach_stream</span><span class="p">(</span><span class="n">stream</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">circuit_id</span><span class="p">)</span><br />        <span class="c">#print('[+] New Circuit id (%s) attached and ready to be used!' % circuit_id)</span><br />      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />        <span class="n">controller</span><span class="o">.</span><span class="n">remove_event_listener</span><span class="p">(</span><span class="n">attach_stream</span><span class="p">)</span><br />        <span class="n">controller</span><span class="o">.</span><span class="n">reset_conf</span><span class="p">(</span><span class="s">'__LeaveStreamsUnattached'</span><span class="p">)</span><br /><br />  <span class="k">try</span><span class="p">:</span><br /><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Creating a New TOR circuit based on path: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span><br />    <span class="n">circuit_id</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">new_circuit</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">await_build</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span><br />    <span class="n">controller</span><span class="o">.</span><span class="n">add_event_listener</span><span class="p">(</span><span class="n">attach_stream</span><span class="p">,</span> <span class="n">stem</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">EventType</span><span class="o">.</span><span class="n">STREAM</span><span class="p">)</span><br />    <span class="n">controller</span><span class="o">.</span><span class="n">set_conf</span><span class="p">(</span><span class="s">'__LeaveStreamsUnattached'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">)</span>  <span class="c"># leave stream management to us</span><br />    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br />    <span class="n">socks</span><span class="o">.</span><span class="n">setdefaultproxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_SOCKS5</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span><br />    <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socks</span><span class="o">.</span><span class="n">socket</span><br /><br />    <span class="n">ip</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="s">'http://ip.42.pl/raw'</span><span class="p">)</span><br />    <span class="k">if</span> <span class="n">ip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span><br />        <span class="n">country</span>  <span class="o">=</span> <span class="n">geolite2</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span> <span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">country</span><br />        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">'</span><span class="p">)</span><br />        <span class="k">print</span><span class="p">(</span><span class="s">'[+] Performing FilePatch,  DNS Spoofing and Certificate Checking</span><span class="se">\</span><br /><span class="s">              passing through --&gt; </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">) </span><span class="se">\n</span><span class="s"> </span><span class="se">\n</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ip</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">country</span><span class="p">))</span>  <span class="p">)</span><br /><br />    <span class="n">time_FileCheck</span> <span class="o">=</span> <span class="n">fileCheck</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] FileCheck took: </span><span class="si">%0.2f</span><span class="s"> seconds'</span>  <span class="o">%</span> <span class="p">(</span> <span class="n">time_FileCheck</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span><br /><br />    <span class="c">#time_CertsCheck  = certsCheck(path)</span><br />    <span class="c">#print('[+] CertsCheck took: %0.2f seconds' % ( time_DNSCheck - start_time))</span><br /><br />    <span class="n">time_DNSCheck</span>  <span class="o">=</span> <span class="n">dnsCheck</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] DNSCheck took: </span><span class="si">%0.2f</span><span class="s"> seconds'</span>   <span class="o">%</span> <span class="p">(</span> <span class="n">time_DNSCheck</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span><br /><br />  <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span>  <span class="n">err</span><span class="p">:</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[-] Circuit creation error: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span><br /><br />  <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><br /><br /><span class="k">def</span> <span class="nf">certsCheck</span><span class="p">(</span><span class="n">path</span><span class="p">):</span><br />    <span class="sd">"""</span><br /><span class="sd">    SSL Strip detection</span><br /><span class="sd">    TODO: It's still a weak control. Need to collect and to compare public_key()</span><br /><span class="sd">    """</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Checking Certificates'</span><span class="p">)</span><br />    <span class="k">try</span><span class="p">:</span><br />        <span class="n">socks</span><span class="o">.</span><span class="n">setdefaultproxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_SOCKS5</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span><br />        <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socks</span><span class="o">.</span><span class="n">socket</span><br /><br />        <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">ssl_strip_monitored_urls</span><span class="p">:</span><br />            <span class="n">cert</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">get_server_certificate</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">),</span> <span class="mi">443</span><span class="p">))</span><br />            <span class="n">x509</span> <span class="o">=</span> <span class="n">OpenSSL</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="n">load_certificate</span><span class="p">(</span><span class="n">OpenSSL</span><span class="o">.</span><span class="n">crypto</span><span class="o">.</span><span class="n">FILETYPE_PEM</span><span class="p">,</span> <span class="n">cert</span><span class="p">)</span><br />            <span class="n">p_k</span>  <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">get_pubkey</span><span class="p">()</span><br />            <span class="n">s_n</span>  <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">get_serial_number</span><span class="p">()</span><br />            <span class="k">for</span> <span class="n">stored_cert</span> <span class="ow">in</span> <span class="n">check_ssl_strip_results</span><span class="p">:</span><br />                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">stored_cert</span><span class="o">.</span><span class="n">domain</span><span class="p">):</span><br />                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">stored_cert</span><span class="o">.</span><span class="n">serial_number</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s_n</span><span class="p">):</span><br />                        <span class="k">print</span><span class="p">(</span><span class="s">'[+] ALERT Found SSL Strip on uri (</span><span class="si">%s</span><span class="s">) through path </span><span class="si">%s</span><span class="s"> '</span> <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span><br />                        <span class="k">break</span><br />                    <span class="k">else</span><span class="p">:</span><br />                        <span class="k">print</span><span class="p">(</span><span class="s">'[+] Certificate Check seems to be OK for </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span><br /><br />    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />        <span class="k">print</span><span class="p">(</span><span class="s">'[-] Error: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span><br />        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br /><br />    <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span><br />    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><span class="k">def</span> <span class="nf">dnsCheck</span><span class="p">(</span><span class="n">path</span><span class="p">):</span><br />    <span class="sd">"""</span><br /><span class="sd">    DNS Poisoning Check</span><br /><span class="sd">    """</span><br />    <span class="k">try</span><span class="p">:</span><br />        <span class="n">socks</span><span class="o">.</span><span class="n">setdefaultproxy</span><span class="p">(</span><span class="n">socks</span><span class="o">.</span><span class="n">PROXY_TYPE_SOCKS5</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">,</span> <span class="mi">9050</span><span class="p">)</span><br />        <span class="n">socket</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">socks</span><span class="o">.</span><span class="n">socket</span><br /><br />        <span class="k">print</span><span class="p">(</span><span class="s">'[+] Checking DNS '</span><span class="p">)</span><br />        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span><br />            <span class="n">ipv4</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><br />            <span class="k">for</span> <span class="n">p_d</span> <span class="ow">in</span> <span class="n">check_domain_poison_results</span><span class="p">:</span><br />                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">p_d</span><span class="o">.</span><span class="n">domain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span><br />                    <span class="n">found</span> <span class="o">=</span> <span class="bp">False</span><br />                    <span class="k">for</span> <span class="n">d_ip</span> <span class="ow">in</span> <span class="n">p_d</span><span class="o">.</span><span class="n">address</span><span class="p">:</span><br />                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">ipv4</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">d_ip</span><span class="p">):</span><br />                            <span class="n">found</span> <span class="o">=</span> <span class="bp">True</span><br />                            <span class="k">break</span><br />                    <span class="k">if</span> <span class="n">found</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span><br />                        <span class="k">print</span><span class="p">(</span><span class="s">'[+] ALERT:DNS SPOOFING FOUND: name: </span><span class="si">%s</span><span class="s"> ip: </span><span class="si">%s</span><span class="s">  (path: </span><span class="si">%s</span><span class="s"> )'</span> <span class="o">%</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">ipv4</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="p">)</span><br />                    <span class="k">else</span><span class="p">:</span><br />                        <span class="k">print</span><span class="p">(</span><span class="s">'[+] Check DNS (</span><span class="si">%s</span><span class="s">) seems to be OK'</span> <span class="o">%</span> <span class="n">domain</span><span class="p">)</span><br />    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />        <span class="k">print</span><span class="p">(</span><span class="s">'[-] Error: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span><br />        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br /><br />    <span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span><br />    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><br /><span class="k">def</span> <span class="nf">fileCheck</span><span class="p">(</span><span class="n">path</span><span class="p">):</span><br />    <span class="sd">"""</span><br /><span class="sd">    Downloading file through TOR circuits doing the hashing</span><br /><span class="sd">    """</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Checking For File patching '</span><span class="p">)</span><br />    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">check_files</span><span class="p">:</span><br />        <span class="k">try</span><span class="p">:</span><br />            <span class="c">#File Rereive</span><br />            <span class="n">data</span> <span class="o">=</span> <span class="n">query</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><br />            <span class="n">file_name</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><br />            <span class="n">_</span><span class="p">,</span><span class="n">tmp_file</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">"exitmap_</span><span class="si">%s</span><span class="s">_"</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">)</span><br />            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">,</span> <span class="s">"wb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span><br />                <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><br />                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">check_files_patch_results</span><span class="p">:</span><br />                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">url</span><span class="p">):</span><br />                        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">filehash</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sha512_file</span><span class="p">(</span><span class="n">tmp_file</span><span class="p">)):</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'[+] ALERT File Patch FOUND !'</span><span class="p">)</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'    | exitnode : </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">exitnode</span><span class="p">)</span>      <span class="p">)</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; url: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>        <span class="p">)</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; filePath: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>   <span class="p">)</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'    |_________&gt; fileHash: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">filehash</span><span class="p">)</span>   <span class="p">)</span><br />                            <span class="c">#check_files_patch_results.append( File_Check_Results(url, file_name, tmp_file, path, sha512_file(tmp_file)) )</span><br />                        <span class="k">else</span> <span class="p">:</span><br />                            <span class="k">print</span><span class="p">(</span><span class="s">'[+] File (</span><span class="si">%s</span><span class="s">) seems to be ok'</span> <span class="o">%</span> <span class="n">i</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><br />                        <span class="k">break</span><br /><br />        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span><br />                <span class="k">print</span><span class="p">(</span><span class="s">'[-] Error ! </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span><br />                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br />                <span class="k">pass</span><br />    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br /><br /><br /><span class="k">def</span> <span class="nf">sha512_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span><br />    <span class="sd">"""</span><br /><span class="sd">    Calculate SHA512 over the given file.</span><br /><span class="sd">    """</span><br /><br />    <span class="n">hash_func</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span><br /><br />    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span><br />        <span class="n">hash_func</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><br /><br />    <span class="k">return</span> <span class="n">hash_func</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><br /><br /><br /><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span><br /><br />    <span class="n">start_analysis</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">"""</span><br /><br /><span class="s">  |=====================================================================|</span><br /><span class="s">  | Find Malicious Relay Nodes is a python script made for checking 3   |</span><br /><span class="s">  | unique kind of frauds such as:                                      |</span><br /><span class="s">  | (1) File Patching                                                   |</span><br /><span class="s">  | (2) DNS Poison                                                      |</span><br /><span class="s">  | (3) SSL Stripping (MITM SSL)                                        |</span><br /><span class="s">  |=====================================================================|</span><br /><span class="s">         """</span><span class="p">)</span><br /><br />    <span class="k">print</span><span class="p">(</span><span class="s">"""</span><br /><span class="s">  |=====================================================================|</span><br /><span class="s">  |                 Initialization Phase                                |</span><br /><span class="s">  |=====================================================================|</span><br /><span class="s">       """</span><span class="p">)</span><br />    <span class="n">dns_setup_time</span>             <span class="o">=</span> <span class="n">resolveOriginalDomains</span><span class="p">()</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] DNS Setup Finished: </span><span class="si">%0.2f</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">dns_setup_time</span> <span class="o">-</span> <span class="n">start_analysis</span><span class="p">))</span><br />    <span class="n">file_check_original_time</span>   <span class="o">=</span> <span class="n">fileCheckOriginal</span><span class="p">()</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] File Setup Finished: </span><span class="si">%0.2f</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_check_original_time</span> <span class="o">-</span> <span class="n">start_analysis</span><span class="p">))</span><br />    <span class="n">ssl_checking_original_time</span> <span class="o">=</span> <span class="n">sslCheckOriginal</span><span class="p">()</span><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Acquiring Certificates  Setup Finished: </span><span class="si">%0.2f</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">ssl_checking_original_time</span> <span class="o">-</span> <span class="n">start_analysis</span><span class="p">))</span><br /><br />    <span class="k">print</span><span class="p">(</span><span class="s">"""</span><br /><span class="s">  |=====================================================================|</span><br /><span class="s">  |                 Analysis  Phase                                     |</span><br /><span class="s">  |=====================================================================|</span><br /><span class="s">          """</span><span class="p">)</span><br /><br />    <span class="k">print</span><span class="p">(</span><span class="s">'[+] Connecting and Fetching possible Relays ...'</span><span class="p">)</span><br />    <span class="k">with</span> <span class="n">stem</span><span class="o">.</span><span class="n">control</span><span class="o">.</span><span class="n">Controller</span><span class="o">.</span><span class="n">from_port</span><span class="p">()</span> <span class="k">as</span> <span class="n">controller</span><span class="p">:</span><br />      <span class="n">controller</span><span class="o">.</span><span class="n">authenticate</span><span class="p">()</span><br /><br />      <span class="n">net_status</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">get_network_statuses</span><span class="p">()</span><br /><br /><br />      <span class="k">for</span> <span class="n">descriptor</span> <span class="ow">in</span> <span class="n">net_status</span><span class="p">:</span><br />        <span class="k">try</span><span class="p">:</span><br />          <span class="n">fingerprint</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">fingerprint</span><br /><br />          <span class="k">print</span><span class="p">(</span><span class="s">'[+] Selecting a New Exit Point:'</span><span class="p">)</span><br />          <span class="k">print</span><span class="p">(</span><span class="s">'[+] |_________&gt; FingerPrint: </span><span class="si">%s</span><span class="s"> '</span> <span class="o">%</span> <span class="n">fingerprint</span><span class="p">)</span><br />          <span class="k">print</span><span class="p">(</span><span class="s">'[+] |_________&gt; Flags: </span><span class="si">%s</span><span class="s"> '</span> <span class="o">%</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span><br />          <span class="k">print</span><span class="p">(</span><span class="s">'[+] |_________&gt; Exit_Policies: </span><span class="si">%s</span><span class="s"> '</span> <span class="o">%</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">exit_policy</span><span class="p">)</span><br /><br />          <span class="k">if</span> <span class="s">'EXIT'</span> <span class="ow">in</span> <span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">flags</span><span class="p">):</span><br />              <span class="k">print</span><span class="p">(</span><span class="s">'[+] Found Exit Point. Performing Scan through EXIT: </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="n">fingerprint</span><span class="p">)</span><br />              <span class="k">if</span> <span class="bp">None</span> <span class="o">==</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">exit_policy</span><span class="p">:</span><br />                  <span class="k">print</span><span class="p">(</span><span class="s">'[+] No Exit Policies found ... no certs checking'</span><span class="p">)</span><br />                  <span class="n">time_taken</span> <span class="o">=</span> <span class="n">scan</span><span class="p">(</span><span class="n">controller</span><span class="p">,</span> <span class="p">[</span><span class="n">TRUSTED_HOP_FINGERPRINT</span><span class="p">,</span> <span class="n">fingerprint</span><span class="p">])</span><br />          <span class="k">else</span><span class="p">:</span><br />              <span class="c">#print('[+] Not Exit Point found. Using it as Relay passing to TRUST Exit Point')</span><br />              <span class="k">pass</span><br />              <span class="c">#time_taken = scan(controller, [fingerprint, TRUSTED_HOP_FINGERPRINT])</span><br />          <span class="c">#print('[+] Finished Analysis for %s finished  =&gt; %0.2f seconds' % (fingerprint, time_taken))</span><br /><br />        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span><br />            <span class="k">print</span><span class="p">(</span><span class="s">'[-] Exception on  FingerPrint: </span><span class="si">%s</span><span class="s"> =&gt; </span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">fingerprint</span><span class="p">,</span> <span class="n">exc</span><span class="p">))</span><br />            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span><br />            <span class="k">pass</span><br /></pre></div><br /><div><br /></div><div><br /></div><div>The<b> RESULTS</b><br /><div style="text-align: justify;">I am not going to publish my results since Tor Relays change over time and what I found using this script might be inaccurate and imprecise: more check must be done. Moreover it could be unpleasant charge specific relays (ergo IP, ergo owners) to be "malicious". But I am going to indorse part of results described by&nbsp;<span style="font-family: &quot;nimbusromno9l&quot;; font-size: 12pt;">Philipp Winte and&nbsp;</span><span style="font-family: &quot;nimbusromno9l&quot;; font-size: 12pt;">Stefan Lindskog published on their&nbsp;</span><span style="font-family: &quot;nimbusromno9l&quot;;">paper (<a href="http://www.cs.kau.se/philwint/spoiled_onions/techreport.pdf">here</a>).</span></div><div style="text-align: justify;"><span style="font-family: &quot;nimbusromno9l&quot;;"><br /></span></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-Lu09YpyOGjM/VnWRmxgC5hI/AAAAAAAAMfs/hg5qoIigKYY/s1600/Screen%2BShot%2B2015-12-19%2Bat%2B18.15.45.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="307" src="http://2.bp.blogspot.com/-Lu09YpyOGjM/VnWRmxgC5hI/AAAAAAAAMfs/hg5qoIigKYY/s400/Screen%2BShot%2B2015-12-19%2Bat%2B18.15.45.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">From Spoiled Onions: Exposing Malicious Tor Exit Relays (Philipp Winter and Stefan Lindskog)</td></tr></tbody></table><div style="text-align: justify;"><span style="font-family: &quot;nimbusromno9l&quot;;">Many of the found Malicious relays have been found on Russia, Turky and Hong Honk. Not every malicious relay used the both techniques to compromise flow but almost one was found. The definitive more used technique is the SSL-Strip MITM mainly used to spy over channels. Few file patching techniques were identified. This kind of attack is useful to spread Malware over the networks and together with DNS poisoning is more used to "attack" rather then to "spy".</span><br /><span style="font-family: &quot;nimbusromno9l&quot;;"><br /></span><span style="font-family: &quot;nimbusromno9l&quot;;">Hope you might enjoy the script, which is quite old and will need a code refactoring session but still interesting (at least on my personal point of view).</span></div><div class="page" title="Page 1"><div class="section"><div class="layoutArea"><div class="column"></div></div></div></div></div></div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Spotting%20Malicious%20Node%20Relays-http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f&title=Spotting%20Malicious%20Node%20Relays" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fspotting-malicious-node-relays%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
