<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> Windows Media Player Integer Overflow. &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Dec 29, 2008</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          • 600 words 3 min. read
        </div>
        <h1>Windows Media Player Integer Overflow.</h1>
        <section id="post-content" class="article-content post">
          <div style="text-align: justify;">Hi Folks, today a Windows Media Player Integer Overflow exploit comes out.<br /></div><div style="text-align: justify;">"Windows Media Player 11 for Windows XP offers great new ways to store and enjoy all your music, video, pictures, and recorded TV. Play it, view it, and sync it to a portable device for enjoying on the go or even share with devices<br /></div><div style="text-align: justify;">around your home—all from one place."<br /></div><div style="text-align: justify;">The author (laurent gaffié) found that Windows Media Player fails to handle exceptional condition when parsing a malformed WAV,SND,MID file. Which can lead to a remote integrer overflow.<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The canonical wave heap format is the following:<br /></div><div style="text-align: justify;"><br /></div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_gK7b9huwiwY/SVihCPlpjyI/AAAAAAAAJ3Y/txZU7ZFdE5I/s1600-h/Picture+2.png"><img style="text-align: justify;display: block; margin-top: 0px; margin-right: auto; margin-bottom: 10px; margin-left: auto; cursor: pointer; width: 400px; height: 353px; " src="http://4.bp.blogspot.com/_gK7b9huwiwY/SVihCPlpjyI/AAAAAAAAJ3Y/txZU7ZFdE5I/s400/Picture+2.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5285151222635532066" /></a><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Where:<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The canonical WAVE format starts with the RIFF header:<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"> <span class="Apple-style-span" style="font-weight: bold;">ChunkID</span>          Contains the letters "RIFF" in ASCII form (0x52494646 big-endian form).<br /></div><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">ChunkSize</span>        36 + SubChunk2Size, or more precisely: 4 + (8 + SubChunk1Size) + (8 + SubChunk2Size) This is the size of the rest of the chunk following this number.  This is the size of the  entire file in bytes minus 8 bytes for the two fields not included in this count: ChunkID and ChunkSize. 8         4   Format           Contains the letters "WAVE" (0x57415645 big-endian form).</span><br /></div></span><div style="text-align: justify;"><br /></div><div><div style="text-align: justify;">The "WAVE" format consists of two subchunks: "fmt " and "data":<br /></div><div style="text-align: justify;">The "fmt " subchunk describes the sound data's format:<br /></div><div style="text-align: justify;"><br /></div><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">Subchunk1ID</span>      Contains the letters "fmt " (0x666d7420 big-endian form).</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">Subchunk1Size</span>    16 for PCM.  This is the size of the rest of the Subchunk which follows this number. 20        2   AudioFormat      PCM = 1 (i.e. Linear quantization) Values other than 1 indicate some form of compression.</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">NumChannels</span>      Mono = 1, Stereo = 2, etc.</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">SampleRate</span>       8000, 44100, etc.</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">ByteRate</span>         == SampleRate * NumChannels * BitsPerSample/8</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">BlockAlign</span>       == NumChannels * BitsPerSample/8 The number of bytes for one sample including all channels. </span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">BitsPerSample</span>    8 bits = 8, 16 bits = 16, etc.</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">ExtraParamSize</span>   if PCM, then doesn't exist</span><br /></div></span><div style="text-align: justify;">X   <span class="Apple-style-span" style="font-weight: bold;">ExtraParams</span>      space for extra parameters<br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The "data" subchunk contains the size of the data and the actual sound:<br /></div><div style="text-align: justify;"><br /></div><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">Subchunk2ID</span>      Contains the letters "data" (0x64617461 big-endian form).</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">Subchunk2Size</span>    == NumSamples * NumChannels * BitsPerSample/8 This is the number of bytes in the data. You can also think of this as the size of the read of the subchunk following this  number.</span><br /></div></span><span class="Apple-style-span" style="font-weight: bold;"><div style="text-align: justify;"><span class="Apple-style-span" style="font-weight: normal; "><span class="Apple-style-span" style="font-weight: bold;">Data</span>             The actual sound data.</span><br /></div></span><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">The exploit builds the following heap:<br /></div><div style="text-align: justify;"><br /></div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_gK7b9huwiwY/SVijlgAL82I/AAAAAAAAJ3g/Up73BkJ0X2A/s1600-h/Picture+3.png"><img style="text-align: justify;display: block; margin-top: 0px; margin-right: auto; margin-bottom: 10px; margin-left: auto; cursor: pointer; width: 400px; height: 58px; " src="http://4.bp.blogspot.com/_gK7b9huwiwY/SVijlgAL82I/AAAAAAAAJ3g/Up73BkJ0X2A/s400/Picture+3.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5285154027360482146" /></a><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Which makes no sense. In fact, if you keep a normal WAVE heap looks like that:<br /></div></div><div style="text-align: justify;"><br /></div><div><div style="text-align: justify;"><br /></div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://2.bp.blogspot.com/_gK7b9huwiwY/SVim1EyvjVI/AAAAAAAAJ3o/piTX0tryKXE/s1600-h/Picture+4.png"><img style="text-align: justify;display: block; margin-top: 0px; margin-right: auto; margin-bottom: 10px; margin-left: auto; cursor: pointer; width: 400px; height: 82px; " src="http://2.bp.blogspot.com/_gK7b9huwiwY/SVim1EyvjVI/AAAAAAAAJ3o/piTX0tryKXE/s400/Picture+4.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5285157593469128018" /></a><div style="text-align: justify;">Every single byte of the "exploit made" WAVE file  is bad formed, no RIFF, no WAVE, no fmt, nothing. An integer overflow comes out during the execution of this "bad formed" multimedia file which eventually allows a remote user to run arbitrary code on victim's  machine. The correct header should start with "52 49 46 46" and should have on byte 9 through byte 12 the word "57 41 56 45" ("WAVE") followed by "66 6d 74 20" ( fmt ). The following image should explain in a easy graphic way what I meant.<br /></div></div><div style="text-align: justify;"><br /></div><div><div style="text-align: justify;"><br /></div><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://1.bp.blogspot.com/_gK7b9huwiwY/SVirXJ3uxFI/AAAAAAAAJ3w/wrNQ5VrLYP4/s1600-h/Picture+122.png"><img style="text-align: justify;display: block; margin-top: 0px; margin-right: auto; margin-bottom: 10px; margin-left: auto; cursor: pointer; width: 400px; height: 248px; " src="http://1.bp.blogspot.com/_gK7b9huwiwY/SVirXJ3uxFI/AAAAAAAAJ3w/wrNQ5VrLYP4/s400/Picture+122.png" border="0" alt="" id="BLOGGER_PHOTO_ID_5285162576994288722" /></a><div style="text-align: justify;">It's very strange discovering that Microsoft makes this mistakes. At the end of the day, with respect to laurent gaffie's work, this bug is a well known integer buffer overflow due to a missed control on a (probably) "error check" 's loop counter. Microsoft should know this problematics.</div><div style="text-align: justify;"><br /></div></div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=Windows%20Media%20Player%20Integer%20Overflow.-http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f&title=Windows%20Media%20Player%20Integer%20Overflow." target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwindows-media-player-integer-overflow.%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
