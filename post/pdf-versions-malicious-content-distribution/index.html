<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> PDF Versions Malicious Content Distribution &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Dec 23, 2014</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          â€¢ 800 words 4 min. read
        </div>
        <h1>PDF Versions Malicious Content Distribution</h1>
        <section id="post-content" class="article-content post">
          <div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;">While attack vectors based on Malicious PDF are a well known topic (<a href="http://www.sans.org/security-resources/malwarefaq/pidief.php" target="_blank">SANS</a>, <a href="http://blog.didierstevens.com/programs/pdf-tools/" target="_blank">Didier's tools</a>), understanding how those vectors are spread up nowadays is an interesting "research" (at least in my personal opinion). Recently, <a href="http://www.yoroi.company/" target="_blank">Yoroi</a> 's toolset gave me the ability to analize almost <b>2k PDF</b> per hour, so I decided to analyze an entire hour of captures harvested from many different sources (mainly emails, repositories and http streams) and to put my findings in this quick and dirty post just to fix them in my "diary".</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Since PDF are one of the most used document format, attackers figured out how to make them malicious.The following image shows a romantic attack vector used to infect a victim through PDF Malware. The infected PDF wraps up an object content which eventually downloads a payload from Internet (for example a .exe or junk of bytes excetuded "directly in memory") and runs it. The payload might perform several tasks such as: reading/writing fylesystem, executing objects, sniffing passwords, listening for contents, substitute content and so on and so forth, making the original PDF malicious.</div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-x2TtWjJUUDc/VJaw3givzsI/AAAAAAAAMH8/OKxWF2dpdHQ/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B12.35.44.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="252" src="http://1.bp.blogspot.com/-x2TtWjJUUDc/VJaw3givzsI/AAAAAAAAMH8/OKxWF2dpdHQ/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B12.35.44.png" width="400" /></a></td></tr><tr align="center"><td class="tr-caption">Romantic Attack Path driven by PDF</td></tr></tbody></table><div style="text-align: justify;">A commonly used way to implement the downloader is through JavaScript which is able to run on PDF in order to introduce simple effects, anchors and dynamisms. The following image shows a simple JavaScript downloader hidden into a PDF.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://1.bp.blogspot.com/-AW6rW0xn5B0/VJaTFtyoxfI/AAAAAAAAMHA/sPtnD6P_-Z8/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B10.24.48.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="286" src="http://1.bp.blogspot.com/-AW6rW0xn5B0/VJaTFtyoxfI/AAAAAAAAMHA/sPtnD6P_-Z8/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B10.24.48.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">A Romantic PDF Malware Object</td></tr></tbody></table><div style="text-align: justify;">My curiosity was about discovering how many malicious PDF over 2k PDF total I was able to find. By using simple scripts I was able to automize the 'first level of analysis' including:</div><ul style="text-align: left;"><li>Downloading PDF from internal/external sources</li><li>Automatize Detection (I borrowed some code from pdfid.py by Didier)</li><li>Calculating simple statistics on analyzed Malware</li></ul>A NodeJs downloader script grabs the entire files from <a href="http://www.yoroi.company/" target="_blank">Yoroi</a>'s internal repository as follows (you might use the same code to download from google or whatever you like).<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-bsrZD-GbQlI/VJatCVtQJFI/AAAAAAAAMHw/QDbWhLPvGE0/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B12.19.15.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="322" src="http://4.bp.blogspot.com/-bsrZD-GbQlI/VJatCVtQJFI/AAAAAAAAMHw/QDbWhLPvGE0/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B12.19.15.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">A simple downloader script</td></tr></tbody></table>Once the PDF has been locally saved, a python script starts its execution to analyze the PDF content. The following image shows a piece of code taken from <a href="http://blog.didierstevens.com/programs/pdf-tools/" target="_blank">Didier's tools</a> (pdfid.py) that has been used to build the automatic first stage analyzer in oder to extract content.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-LptXM17JLM0/VJaWw6nQFyI/AAAAAAAAMHc/mbOUN-nfOlU/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B10.44.34.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="400" src="http://4.bp.blogspot.com/-LptXM17JLM0/VJaWw6nQFyI/AAAAAAAAMHc/mbOUN-nfOlU/s1600/Screen%2BShot%2B2014-12-21%2Bat%2B10.44.34.png" width="393" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Analyze PDF content from pdfid.py by&nbsp; Didier Stevens</td></tr></tbody></table><div style="text-align: justify;">A post processing static analyzer runs to figure out the "stream content maliciousness". After several hours of computational analysis (ok, performances and timing were not an issues in my case since what I did was just for personal curiosity) I came out with the following results:</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Total PDF analyzed: <b>1988 </b></div><div style="text-align: justify;">Total Size on Disk: <b>1.83GB</b></div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Figuring out the most affected PDF version was my next step. The following graph shows the distribution of malicious content (JS, Encrypted and Embedded File) found in 1988 PDFs.<b> </b></div><b><br /></b><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-UqfrOPc2nEg/VJhnIMIlCsI/AAAAAAAAMIc/Tuq76RxBYUE/s1600/MalcontentPDF.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="268" src="http://2.bp.blogspot.com/-UqfrOPc2nEg/VJhnIMIlCsI/AAAAAAAAMIc/Tuq76RxBYUE/s1600/MalcontentPDF.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Malicious Content Over PDF Version</td></tr></tbody></table><b><br /></b><br /><div style="text-align: justify;">If we assume the analyzed set of data as "significant set of data" we might assert that PDF1.1 and PDF1.7 are the most safe PDF versions regarding malicious JS, EncryptedContent and Embedded Executalbes. Less than ten (10) malicious contents were found in both versions. Contrary PDF1.6 and PDF1.4 result as the most "affecteed" PDF versions. But malicious contents might hid after EOF and use the PDF as a passive carrier. The following graph shows the distribution of malicious content found after the End Of File.</div><div style="text-align: justify;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-2YmrHeP3K1I/VJhqgueRc1I/AAAAAAAAMIo/HWlW7kBleTE/s1600/PDFMalBytesAfterEOF.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="303" src="http://4.bp.blogspot.com/-2YmrHeP3K1I/VJhqgueRc1I/AAAAAAAAMIo/HWlW7kBleTE/s1600/PDFMalBytesAfterEOF.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Malicious Content after EOF</td></tr></tbody></table><div style="text-align: justify;"><br /></div><div style="text-align: justify;">If we assume the analyzed set of data as "significant set of data" we might assert that PDF version 1.1 and PDF version 1.2 are the most safe versions against malicious content after the End Of File. S<span class="short_text" id="result_box" lang="en"><span class="hps">urprisingly PDF version 1.7 is not "so safe" anymore. Comparing the averall data I came out with the following pie chart in where we might appreciate the fact that PDF version 1.4 is the most affected of malicious contents. We might see PDF version 1.3, PDF version 1.5 and PDF version 1.6 following it.&nbsp;&nbsp;</span></span></div><span class="short_text" id="result_box" lang="en"><span class="hps"><br /></span></span><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-fhT2gThGQ40/VJhrXZNFY0I/AAAAAAAAMIw/Ons_UT7lZ2I/s1600/PieOverall.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="316" src="http://4.bp.blogspot.com/-fhT2gThGQ40/VJhrXZNFY0I/AAAAAAAAMIw/Ons_UT7lZ2I/s1600/PieOverall.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Overall Malicious Content By Type</td></tr></tbody></table><br /><span class="short_text" id="result_box" lang="en"><span class="hps"></span></span>Not much conclusions here: if you are working with these versions most (1.4,1.3,1.5), you'd better watch out since  the probability to get a Malware PDF is higher than other PDF versions.<br /><br />Just remember we are assuming the data I collected as significant data because comming from many different organizations within different businesses. <br /><br />I do have an open question so far:<br /><ol style="text-align: left;"><li>Does it make sense for anti-malware engines ponderate the use of computational resources depending of what PDF version is currently processing? For example: if an anti-Malware is running analysis on PDF version 1.6 should it allocate more computational resource (RAM, CPU, IO, etc.) rather then if it is analysing PDF version 1.1 ?</li></ol><b>&nbsp;</b> </div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=PDF%20Versions%20Malicious%20Content%20Distribution-http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f&title=PDF%20Versions%20Malicious%20Content%20Distribution" target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fpdf-versions-malicious-content-distribution%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
