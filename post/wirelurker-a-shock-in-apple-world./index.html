<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title> WireLurker, a shock in Apple World. &middot; Marco Ramilli </title>
    
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/uno.min.css" />
    <link rel="stylesheet" type="text/css" href="http://marcoramilli.com/css/lightGallery.css" />
    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://marcoramilli.com/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="images/favicon.ico">
    
    <link href="" rel="alternate" type="application/rss+xml" title="Marco Ramilli" />
    
    <script src="http://marcoramilli.com/js/jquery.min.js"></script>
    <script src="http://marcoramilli.com/js/main.min.js">
    </script>
</head>

<body>
  <div id="scriptHeader">
    <span class="mobile btn-mobile-menu">
            <i class="fa fa-bars btn-mobile-menu__icon"></i>
            <i class="fa fa-times btn-mobile-close__icon hidden"> </i>
    </span>
    <header class="
        
            panel-cover panel-cover--collapsed
        "  style="background-image: url(/images/background-cover.jpg)" >
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content"> 
                <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                <h1 class="panel-cover__title panel-title">
                    <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                </h1>
                <hr class="panel-cover__divider" />
                <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                  <hr class="panel-cover__divider panel-cover__divider--secondary" />


                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fa fa-code-fork'></i></a>  
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                        </nav> 
                    </div>
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>


            </div>
        </div>
        <div class="panel-cover--overlay"></div>
    </div>
</header>
</div>
<noscript>
    <style>
        #scriptHeader {display:none;}
        .navigation-wrapper{
            display: block;
            top: 0;
        }
    </style>

    <header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
        <div class="panel-main">
            <div class="panel-main__inner panel-inverted">
                <div class="panel-main__content"> 
                    <a href="http://marcoramilli.com/" title="link to homepage for Marco Ramilli"> <img src="http://marcoramilli.com/images/MR.jpg" width="80" alt="Marco Ramilli logo" class="panel-cover__logo logo" /> </a> 
                    <h1 class="panel-cover__title panel-title">
                        <a href="http://marcoramilli.com/"  title="link to homepage for Marco Ramilli">Marco Ramilli</a>
                    </h1>
                    <hr class="panel-cover__divider" />
                    <p class="panel-cover__description">  cat /dev/random | grep cybersecurity  </p>
                    <hr class="panel-cover__divider panel-cover__divider--secondary" />
                    <div class="navigation-wrapper">
                        <nav class="cover-navigation cover-navigation--primary">
                            <ul class="navigation">
                              <li class="navigation__item"><a href="http://marcoramilli.com/#blog" title="link to Marco Ramilli blog"> <i  class='fa fa-th'></i></a> </li></br>
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/about" title="About "> <i  class='fa fa-user'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/projects" title="Some of my Projects"> <i  class='fafa-code-fork'></i></a> </li></br> 
                                  <li class="navigation__item"><a href="http://marcoramilli.com/pages/publications" title="Selected Publications"> <i class='fa fa-book'> </i></a>  
                           </ul>
                        </nav> <nav class="cover-navigation navigation--social">
    <ul class="navigation"> 
        
        <li class="navigation__item">
            <a href="http://twitter.com/Marco_Ramilli" title="@Marco_Ramilli on Twitter"> <i class='fa fa-twitter'></i> <span class="label">Twitter</span> </a>
        </li>   
        
        <li class="navigation__item">
            <a href="https://github.com/marcoramilli" title="marcoramilli on github"> <i class='fa fa-github'></i> <span class="label">Github</span> </a>
        </li>  </br>  
        
        <li class="navigation__item">
            <a href="https://www.linkedin.com/in/marcoramilli" title="Linkedin"> <i class='fa fa-linkedin'></i> <span class="label">Linkedin</span> </a>
        </li>  
        
        <li class="navigation__item">
            <a href="mailto:mramilli@gmail.com" title="Email mramilli@gmail.com"> <i class='fa fa-envelope-o'></i> <span class="label">Email</span> </a>
        </li>  </ul>
</nav>
 </div>
                </div>
            </div>
            <div class="panel-cover--overlay"></div>
        </div>
    </header>
</noscript>

  <div class="content-wrapper">
    <div class="content-wrapper__inner">
      <div class="post">
        <div class="post-meta">
          <span class="post-meta__date date">Nov 6, 2014</span>
          
          <span class="post-meta__tags tags">
            <font class="tags">
              
            </font>
          </span>
          • 700 words 4 min. read
        </div>
        <h1>WireLurker, a shock in Apple World.</h1>
        <section id="post-content" class="article-content post">
          <div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: justify;">I am not used to write "Malware centric" posts, contrary I do love to focalize my writing on specific techniques used by Malware to infect systems and/or to evade analysis. However today,&nbsp; I want to stamp in my digital diary <a href="http://researchcenter.paloaltonetworks.com/2014/11/wirelurker-new-era-os-x-ios-malware/" target="_blank">WireLurker</a> since I see a "paradigm shift" on it. I find it a super fascinating peace of code where motivations are still unclear. WireLurker has been firstly analyzed by <a href="https://www.paloaltonetworks.com/threat-research.html" target="_blank">Unit42</a> (Palo Alto Networks) and suddenly became a quite <a href="http://www.webnews.it/2014/11/06/malware-wirelurker-ios-os-x-cina/" target="_blank">spread news</a>. It targets OSX and iOS devices (one of the first Malware entirely written for Apple platforms). WireLurker owns the following specif characteristics:</div><ul style="text-align: justify;"><li>It is only the second known malware family that attacks iOS devices through OS X via USB&nbsp;</li><li>It is the first malware to automate generation of malicious iOS applications, through binary file replacement&nbsp;</li><li>It is the first known malware that can infect installed iOS applications similar to a traditional virus&nbsp;</li><li>It is the first in-the-wild malware to install third-party applications on non-jailbroken iOS devices through enterprise provisioning&nbsp;</li></ul><div style="text-align: justify;">PaloAlto networks writes:</div><div style="text-align: justify;"><blockquote class="tr_bq"><i>Of known malware families distributed through trojanized / repackaged OS X applications, it is the biggest in scale we have ever seen.&nbsp; </i><i>.</i></blockquote></div><div style="text-align: justify;">&nbsp;WireLurker was used to trojanize 467 OS X applications on the Maiyadi  App Store, a third-party Mac application store in China. In the past six  months, these 467 infected applications were downloaded over <b>356,104</b> times and may have impacted hundreds of thousands of users. The following image shows the complete infection workflow.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-N_A4kTDRdAo/VFslVsbaDMI/AAAAAAAAL-Y/2jtNf4hnGgM/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.37.30.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-N_A4kTDRdAo/VFslVsbaDMI/AAAAAAAAL-Y/2jtNf4hnGgM/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.37.30.png" height="271" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Complete infection workflow: From PaloAlto unit42 report</td></tr></tbody></table><br /><div style="text-align: justify;">Fascinating how simple is the thechnique used by the Malware writers to Trojanize a legitime APP.&nbsp; Please substitute %@ with real paths to make sense on it.</div><div class="separator" style="clear: both; text-align: center;"></div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-p5bxemvj5fk/VFsmmv-d-CI/AAAAAAAAL-o/85yAYKWGqN8/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.42.20.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-p5bxemvj5fk/VFsmmv-d-CI/AAAAAAAAL-o/85yAYKWGqN8/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.42.20.png" height="167" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Trojanize script used by WireLurker. From PaloAlto unit42 report</td></tr></tbody></table><div style="text-align: justify;">Once the "Trojanized App" has been saved on the infected machine, WireLurker builds its own "empire" by downloading applications, updating itslef and hiding files into folders spread on the file system. The following image&nbsp; shows the amount of dropped, created, deleted file into the targeted machine.</div><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-v5-w873tc9s/VFsnmYkFm9I/AAAAAAAAL-w/VBEiYZQtvkI/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.44.27.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-v5-w873tc9s/VFsnmYkFm9I/AAAAAAAAL-w/VBEiYZQtvkI/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.44.27.png" height="313" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">From PaloAlto unit42 report</td></tr></tbody></table><div style="text-align: justify;">Even more fascinating the way WireLurker get persistence on the device. Generally speaking WireLurker runs as a background process, waiting for iOS devices to infect over USB connection, this represents a quite simple process, however it adopts multiple redundancy methods to guarantee its own presence such as:</div><ul style="text-align: left;"><li style="text-align: justify;">It does not check if the device is already infected, each time it executes malicious code.&nbsp;</li><ul><li style="text-align: justify;">This is actually a weak point. Detectors might exploit this behavior to identify it.</li><li style="text-align: justify;">It is not really "silent" adopting this "forcing method"</li></ul><li style="text-align: justify;">WireLurker initialization and update scripts create and load launch daemons, ensuring persistence after reboot.</li><ul><li style="text-align: justify;">Pretty simple approach if compared to complex Bootkit Malware who does not initialized a direct daemon. </li></ul><li style="text-align: justify;">It invokes the following launchctl&nbsp;</li></ul><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-_zJ4jFReBXQ/VFso5T6DdsI/AAAAAAAAL-4/XzZ5axi2Dkk/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.52.22.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-_zJ4jFReBXQ/VFso5T6DdsI/AAAAAAAAL-4/XzZ5axi2Dkk/s1600/Screen%2BShot%2B2014-11-06%2Bat%2B08.52.22.png" height="83" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">From PaloAlto unit42 report</td><td class="tr-caption" style="text-align: center;"><br /></td><td class="tr-caption" style="text-align: center;"><br /></td><td class="tr-caption" style="text-align: center;"><br /></td></tr></tbody></table><br /><div style="text-align: justify;">Comunication to Command and Control happens by using a <b>Data</b> <b>Encryption</b> <b>Standard</b> (DES) with <b>Cryptographic</b> <b>Message</b> <b>Syntax</b> <b>Standard</b> (PKCS7) padding. Researcher from PaloAlto Networks figured out that for each piece of TCP data WireLurker receives or sends, the first 10 bytes of the data are used to generate a session key. The session key is then combined with a fixed string, “dksyel”, to generate a decryption key. Remaining bytes of the data are encrypted data that has also been encoded using Base64. From here the analysis is quite usual.</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Quoting the unit42 report:</div><div style="text-align: justify;"></div><div style="text-align: justify;"><blockquote class="tr_bq">The ultimate goal of the WireLurker attacks is not completely clear. The functionality and infrastructure allows the attacker to collect significant amounts of information from a large number of Chinese iOS and Mac OS systems, but none of the information points to a specific motive. As infected devices regularly request updates from the attackers command and control server, new features or applications could be installed at any time. It’s clear the tool set is still undergoing active development and we believe WireLurker has not yet revealed its full functionality. </blockquote>&nbsp;</div><div><ul style="text-align: left;"></ul><div style="text-align: justify;">It is a quite weird behavior. Right now I do not have enough elements to understand the goal of such a targeted attack. Having a general information about Apple device owners seems to me a quite original target per se. For shure the security perspective for Apple users have been deeply changed.</div><br /><br /></div></div>

        </section>
      </div>
      <div class="sharing">
<a href="https://twitter.com/intent/tweet?status=WireLurker%2c%20a%20shock%20in%20Apple%20World.-http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f" target="_blank" title="Follow me on Twitter" class="twitter">
<span class="fa fa-twitter-square fa-3x"></span></a>
<a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f" target="_blank" title="Join me on Facebook" class="facebook">
<span class="fa fa-facebook-square fa-3x"></span></a>
<a href="https://plus.google.com/share?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f" target="_blank" title="Google+" class="googleplus">
<span class="fa fa-google-plus-square fa-3x"></span></a>
<a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f&title=WireLurker%2c%20a%20shock%20in%20Apple%20World." target="_blank" title="LinkedIn" class="linkedin">
<span class="fa fa-linkedin-square fa-3x"></span></a>
<a href="http://www.reddit.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f" target="_blank" title="Reddit" class="reddit"><span class="fa fa-reddit-square fa-3x"></span></a>
<a href="http://www.stumbleupon.com/submit?url=http%3a%2f%2fmarcoramilli.com%2fpost%2fwirelurker-a-shock-in-apple-world.%2f" target="_blank" title="StumbleUpon" class="stumbleupon"><span class="fa fa-stumbleupon fa-3x">
</span></a>
</div>

      



      <footer class="footer"></footer>

    </div>
  </div>
</body>
<script type="text/javascript" src="http://marcoramilli.com/js/awesome-toc.min.js"></script>
<script type="text/javascript">
$.awesome_toc({        
      title: "Index",
          overlay: true,
              contentId: "post-content",
});
</script>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5633272-11', 'auto');
  ga('send', 'pageview');
</script>


</html>
